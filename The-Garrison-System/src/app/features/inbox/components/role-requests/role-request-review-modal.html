<div class="modal-overlay" (click)="onOverlayClick($event)">
  <div class="modal review-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Revisar Solicitud de Rol</h2>
      <button class="close-btn" type="button" (click)="onClose()">×</button>
    </div>

    <form (ngSubmit)="onSubmit()" class="modal-body">
      <div class="request-summary">
        <div class="summary-item">
          <span class="label">Usuario:</span>
          <div class="value">
            <strong>{{ request.user.username }}</strong>
            <small>{{ request.user.email }}</small>
          </div>
        </div>

        <div class="summary-item">
          <span class="label">Solicitud:</span>
          <div class="value">
            <div *ngIf="request.isRoleChange" class="role-change">
              <span class="role-badge">{{ getRoleLabel(request.roleToRemove!) }}</span>
              <span class="arrow">→</span>
              <span class="role-badge">{{ getRoleLabel(request.requestedRole) }}</span>
              <small class="change-label">Cambio de rol</small>
            </div>
            <span *ngIf="!request.isRoleChange" class="role-badge">
              {{ getRoleLabel(request.requestedRole) }}
            </span>
          </div>
        </div>

        <div class="summary-item">
          <span class="label">Fecha:</span>
          <span class="value">{{ formatDate(request.createdAt) }}</span>
        </div>

        <div *ngIf="request.justification" class="summary-item full-width">
          <span class="label">Justificación:</span>
          <p class="justification">{{ request.justification }}</p>
        </div>
      </div>

      <div *ngIf="error" class="error-message">
        <span class="icon">⚠️</span>
        {{ error }}
      </div>

      <div class="form-group">
        <label>Decisión:</label>
        <div class="action-selector">
          <label [class.selected]="action === 'approve'" class="action-option">
            <input type="radio" name="action" value="approve" [(ngModel)]="action" [disabled]="isSubmitting" />
            <span class="icon">✓</span>
            <span class="text">Aprobar</span>
          </label>

          <label [class.selected]="action === 'reject'" class="action-option">
            <input type="radio" name="action" value="reject" [(ngModel)]="action" [disabled]="isSubmitting" />
            <span class="icon">✗</span>
            <span class="text">Rechazar</span>
          </label>
        </div>
      </div>

      <div class="form-group">
        <label for="comments">
          Comentarios <span *ngIf="action === 'reject'">(recomendado)</span>:
        </label>
        <textarea id="comments" [(ngModel)]="comments" name="comments"
          placeholder="Añade comentarios sobre tu decisión..." [disabled]="isSubmitting" rows="4"
          maxlength="500"></textarea>
        <div class="character-count">{{ comments.length }}/500 caracteres</div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="onClose()" [disabled]="isSubmitting">
          Cancelar
        </button>
        <button type="submit" [class]="action === 'approve' ? 'btn btn-success' : 'btn btn-danger'"
          [disabled]="isSubmitting">
          {{ isSubmitting
          ? 'Procesando...'
          : action === 'approve'
          ? 'Aprobar Solicitud'
          : 'Rechazar Solicitud' }}
        </button>
      </div>
    </form>
  </div>
</div>