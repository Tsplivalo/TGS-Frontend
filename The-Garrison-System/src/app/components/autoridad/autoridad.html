<section class="stack-lg">

  <!-- LISTA -->
  <div class="glass-dark card stack-md">
    <div class="header">
      <h2>Autoridades</h2>
      <div class="right">
        <button class="btn" (click)="toggleForm()" [attr.aria-expanded]="formAbierto">
          {{ formAbierto ? 'Cerrar' : 'Nueva' }}
        </button>
      </div>
    </div>

    <!-- Filtros -->
    <div class="filters">
      <label class="label">
        <span>Buscar</span>
        <input class="input" placeholder="dni / nombre / rango" [(ngModel)]="fTexto" />
      </label>

      <label class="label">
        <span>Zona ID</span>
        <input class="input" placeholder="1" [(ngModel)]="fZonaId" />
      </label>
    </div>

    <!-- Tabla -->
    <div class="table-wrap">
      <table class="table" *ngIf="autoridadesFiltradas().length; else empty">
        <!-- Fijar anchos para alinear -->
        <colgroup>
          <col style="width:120px" /> <!-- DNI -->
          <col /> <!-- Nombre -->
          <col style="width:160px" /> <!-- Rango -->
          <col style="width:160px" /> <!-- Zona -->
          <col style="width:220px" /> <!-- Acciones -->
        </colgroup>

        <thead>
          <tr>
            <th>DNI</th>
            <th>Nombre</th>
            <th>Rango</th>
            <th>Zona</th>
            <th class="right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let a of autoridadesFiltradas()">
            <td>#{{ a.dni }}</td>
            <td><span class="truncate">{{ a.nombre }}</span></td>
            <td><span class="truncate">{{ a.rango }}</span></td>
            <td><span class="truncate">{{ getZonaTexto(a) }}</span></td>
            <td class="right">
              <button class="btn ghost" (click)="editar(a); formAbierto = true">Editar</button>
              <button class="btn danger" (click)="eliminar(a.dni)">Eliminar</button>
            </td>
          </tr>
        </tbody>
      </table>

      <ng-template #empty>
        <div class="center muted">Sin autoridades</div>
      </ng-template>
    </div>
  </div>

  <!-- FORM (PLEGABLE, MISMO ESTILO) -->
  <div class="collapsible" [class.open]="formAbierto">
    <div class="collapsible__content glass-dark card">
      <div class="header">
        <h2>{{ editDni() == null ? 'Nueva autoridad' : ('Editar autoridad: ' + editDni()) }}</h2>
      </div>

      <form [formGroup]="form" (ngSubmit)="guardar()" class="form-grid">

        <!-- errores -->
        <div class="error" *ngIf="error()">{{ error() }}</div>
        <div class="error" *ngIf="submitted() && form.invalid">
          {{ editDni() == null
          ? 'Completá DNI, Nombre, Email, Rango y Zona.'
          : 'Completá Nombre, Rango y Zona (email no es requerido en edición).' }}
        </div>

        <label class="label">
          <span>DNI</span>
          <input class="input" formControlName="dni" maxlength="8" placeholder="Ingrese DNI"
            [readonly]="editDni() !== null" />
        </label>

        <label class="label">
          <span>Nombre</span>
          <input class="input" formControlName="nombre" placeholder="Juan Pérez" />
        </label>

        <label class="label">
          <span>Email</span>
          <input class="input" type="email" formControlName="email" placeholder="juan@mail.com" />
        </label>

        <label class="label">
          <span>Teléfono</span>
          <input class="input" formControlName="telefono" placeholder="+54..." />
        </label>

        <label class="label">
          <span>Dirección</span>
          <input class="input" formControlName="direccion" placeholder="Calle 123" />
        </label>

        <label class="label">
          <span>Rango</span>
          <select class="input" formControlName="rango">
            <option value="0">0 - Rango 0</option>
            <option value="1">1 - Rango 1</option>
            <option value="2">2 - Rango 2</option>
            <option value="3">3 - Rango 3</option>
          </select>
        </label>

        <label class="label">
          <span>Zona ID</span>
          <input class="input" formControlName="zonaId" placeholder="1" />
        </label>

        <div class="right form-actions">
          <button class="btn success" type="submit" [disabled]="loading()">
            {{ editDni() == null ? 'Crear' : 'Guardar' }}
          </button>
          <button class="btn ghost" type="button" (click)="nuevo(); formAbierto = false">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

</section>