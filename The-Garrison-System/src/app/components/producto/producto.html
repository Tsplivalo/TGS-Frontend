<div class="page producto">

  <!-- Toolbar -->
  <header class="toolbar card--elev">
    <h1 class="title">Productos</h1>
    <div class="spacer"></div>
    <button class="btn" type="button" (click)="nuevo()">+ Nuevo producto</button>
  </header>

  <!-- Mensajes -->
  <div class="alert error" *ngIf="error() as err">
    <strong>Error:</strong> {{ err }}
  </div>
  <div class="alert info" *ngIf="loading()">Cargando productos...</div>

  <!-- Filtros -->
  <section class="card filtros">
    <h2 class="card-title">Filtros</h2>
    <div class="filters">
      <label>
        <span class="label-text">Buscar</span>
        <input class="input" type="text" placeholder="Nombre o categoría" [value]="fTexto()"
          (input)="fTexto.set($any($event.target).value)" />
      </label>

      <label>
        <span class="label-text">Stock</span>
        <select class="input" [value]="fStock()" (change)="fStock.set($any($event.target).value)">
          <option value="todos">Todos</option>
          <option value="con">Con stock</option>
          <option value="sin">Sin stock</option>
        </select>
      </label>
    </div>
  </section>

  <!-- Tabla -->
  <section class="card listado">
    <h2 class="card-title">Listado</h2>

    <div class="table-wrapper" *ngIf="listaFiltrada().length; else emptyState">
      <table class="table table-hover">
        <thead>
          <tr>
            <th style="width:80px;">ID</th>
            <th>Descripción</th>
            <th style="width:140px;">Precio</th>
            <th style="width:120px;">Stock</th>
            <th style="width:120px;">Ilegal</th>
            <th style="width:200px;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of listaFiltrada()">
            <td>#{{ p.id }}</td>
            <td>{{ p.descripcion }}</td>
            <td>{{ p.precio | currency:'ARS':'symbol':'1.0-2' }}</td>
            <td>
              <span class="badge" [class.badge-warn]="p.stock === 0">{{ p.stock }}</span>
            </td>
            <td>
              <span class="badge" [class.badge-danger]="p.esIlegal" [class.badge-ok]="!p.esIlegal">
                {{ p.esIlegal ? 'Sí' : 'No' }}
              </span>
            </td>
            <td class="actions">
              <button class="btn ghost" type="button" (click)="editar(p)">Editar</button>
              <button class="btn danger" type="button" (click)="eliminar(p.id)" [disabled]="loading()">Eliminar</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty state -->
    <ng-template #emptyState>
      <div class="empty">
        <h3>No hay productos</h3>
        <p>Probá ajustar los filtros o creá un producto nuevo.</p>
        <button class="btn" type="button" (click)="nuevo()">+ Crear producto</button>
      </div>
    </ng-template>
  </section>

  <!-- Formulario -->
  <section class="card formulario">
    <h2 class="card-title">
      {{ editId() == null ? 'Crear producto' : ('Editar producto #' + editId()) }}
    </h2>

    <form [formGroup]="form" (ngSubmit)="guardar()" class="form-grid">

      <label class="label col-2">
        <span>Descripción</span>
        <input class="input" formControlName="descripcion" placeholder="Descripción del producto" />
        <small class="hint" *ngIf="form.controls.descripcion.invalid && form.controls.descripcion.touched">
          Campo requerido.
        </small>
      </label>

      <label class="label">
        <span>Precio</span>
        <input class="input" type="number" min="0" formControlName="precio" />
        <small class="hint" *ngIf="form.controls.precio.invalid && form.controls.precio.touched">
          Ingresá un precio válido.
        </small>
      </label>

      <label class="label">
        <span>Stock</span>
        <input class="input" type="number" min="0" formControlName="stock" />
        <small class="hint" *ngIf="form.controls.stock.invalid && form.controls.stock.touched">
          Ingresá un stock válido.
        </small>
      </label>

      <label class="label switch">
        <input type="checkbox" formControlName="esIlegal" />
        <span>¿Es ilegal?</span>
      </label>

      <div class="form-actions">
        <button class="btn success" type="submit" [disabled]="form.invalid || loading()">
          {{ editId() == null ? 'Crear' : 'Guardar' }}
        </button>
        <button class="btn ghost" type="button" (click)="nuevo()" [disabled]="loading()">Cancelar</button>
      </div>
    </form>
  </section>
</div>