<section class="stack-lg">
  <div class="glass-dark card stack-md">
    <div class="header">
      <h2>{{ 'products.title' | translate }}</h2>
      <div class="right">
        <button class="btn" (click)="new()">{{ 'common.new' | translate }}</button>
      </div>
    </div>

    <div *ngIf="error()" class="error">{{ error() }}</div>

    <form class="grid form" [formGroup]="form" (ngSubmit)="save()">
      <label class="label">
        <span>{{ 'products.description' | translate }}</span>
        <input class="input" formControlName="description" />
        <small class="hint" *ngIf="form.controls.description.invalid && form.controls.description.touched">
          {{ 'products.validation.description' | translate }}
        </small>
      </label>

      <label class="label" style="grid-column: 1 / -1;">
        <span>{{ 'products.detail' | translate }}</span>
        <textarea class="input" formControlName="detail" rows="2"></textarea>
        <small class="hint" *ngIf="form.controls.detail.invalid && form.controls.detail.touched">
          {{ 'products.validation.detail' | translate }}
        </small>
      </label>

      <label class="label">
        <span>{{ 'products.price' | translate }}</span>
        <input type="number" class="input" formControlName="price" step="0.01" />
      </label>

      <label class="label">
        <span>{{ 'products.stock' | translate }}</span>
        <input type="number" class="input" formControlName="stock" />
      </label>

      <label class="label checkbox">
        <input type="checkbox" formControlName="isIllegal" />
        <span>{{ 'products.isIllegal' | translate }}</span>
      </label>

      <!-- Solo front -->
      <label class="label" style="grid-column: 1 / -1;">
        <span>{{ 'products.imageUrl' | translate }}</span>
        <input class="input" formControlName="imageUrl" placeholder="https://..." />
      </label>

      <div class="right" style="grid-column: 1 / -1;">
        <button class="btn success" type="submit" [disabled]="loading()">
          {{ (editId() == null ? 'common.create' : 'common.save') | translate }}
        </button>
        <button class="btn ghost" type="button" (click)="new()">
          {{ 'common.cancel' | translate }}
        </button>
      </div>
    </form>

    <hr />

    <div *ngIf="loading()">{{ 'common.loading' | translate }}</div>

    <table class="table" *ngIf="!loading()">
      <thead>
        <tr>
          <th>ID</th>
          <th>{{ 'products.description' | translate }}</th>
          <th>{{ 'products.detail' | translate }}</th>
          <th>{{ 'products.price' | translate }}</th>
          <th>{{ 'products.stock' | translate }}</th>
          <th>{{ 'products.isIllegal' | translate }}</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <!-- trackBy correcto -->
        <tr *ngFor="let p of items(); trackBy: trackById">
          <td>{{ p.id }}</td>
          <td>{{ p.description }}</td>
          <td>{{ p.detail }}</td>
          <td>{{ p.price | number:'1.2-2' }}</td>
          <td>{{ p.stock }}</td>
          <td>{{ p.isIllegal ? '⚠️' : '✅' }}</td>
          <td class="right">
            <button class="btn" (click)="edit(p)">{{ 'common.edit' | translate }}</button>
            <button class="btn danger" (click)="remove(p.id)">{{ 'common.delete' | translate }}</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>