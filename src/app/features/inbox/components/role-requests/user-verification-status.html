<!-- user-verification-status.component.html -->
<div class="user-verification-status">
  <!-- Header -->
  <div class="verification-header">
    <div>
      <h2>{{ 'userVerification.status.title' | translate }}</h2>
      <p class="subtitle">{{ 'userVerification.status.subtitle' | translate }}</p>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>{{ 'userVerification.status.loading' | translate }}</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error && !loading" class="error-message">
    <span class="icon">‚ö†Ô∏è</span>
    <div class="error-content">
      <strong>{{ 'userVerification.status.error.title' | translate }}</strong>
      <p>{{ error }}</p>
    </div>
    <button class="btn-link" (click)="error = null">{{ 'userVerification.status.error.close' | translate }}</button>
  </div>

  <!-- Verified -->
  <div *ngIf="isVerified && !loading" class="verified-card">
    <div class="verified-icon">‚úÖ</div>
    <h3>{{ 'userVerification.status.verified.title' | translate }}</h3>
    <p>{{ 'userVerification.status.verified.desc' | translate }}</p>

    <div class="verified-benefits">
      <h4>{{ 'userVerification.status.verified.benefitsTitle' | translate }}</h4>
      <ul>
        <li *ngFor="let b of ('userVerification.status.verified.benefits' | translate)">{{ b }}</li>
      </ul>
    </div>
  </div>

  <!-- Not Verified - No Request -->
  <div *ngIf="!isVerified && !verificationStatus && !loading" class="no-verification-card">
    <div class="info-icon">üìã</div>
    <h3>{{ 'userVerification.status.request.title' | translate }}</h3>
    <p>{{ 'userVerification.status.request.desc' | translate }}</p>

    <!-- Warning si NO tiene perfil completo -->
    <div *ngIf="!hasCompleteProfile" class="alert alert-warning">
      <span class="icon">‚ö†Ô∏è</span>
      <div>
        <strong>{{ 'userVerification.status.profileIncomplete.title' | translate }}</strong>
        <p>{{ 'userVerification.status.profileIncomplete.desc' | translate }}</p>
        <a routerLink="/mi-cuenta" class="btn btn-secondary btn-sm">
          <span class="icon">üìù</span>
          {{ 'userVerification.status.profileIncomplete.completeNow' | translate }}
        </a>
      </div>
    </div>

    <!-- Progress Indicator -->
    <div *ngIf="!hasCompleteProfile" class="profile-progress">
      <h4>{{ 'userVerification.status.progress.title' | translate }}</h4>
      <div class="progress-items">
        <div class="progress-item completed">
          <span class="icon">‚úÖ</span>
          <span class="text">{{ 'userVerification.status.progress.created' | translate }}</span>
        </div>
        <div class="progress-item completed">
          <span class="icon">‚úÖ</span>
          <span class="text">{{ 'userVerification.status.progress.emailVerified' | translate }}</span>
        </div>
        <div class="progress-item" [class.completed]="hasCompleteProfile">
          <span class="icon">{{ hasCompleteProfile ? '‚úÖ' : '‚è≥' }}</span>
          <span class="text">
            {{ 'userVerification.status.progress.profileCompleted' | translate:{ percent: hasCompleteProfile ? 100 : '<
              100' } }} </span>
        </div>
        <div class="progress-item" [class.completed]="isVerified">
          <span class="icon">{{ isVerified ? '‚úÖ' : '‚è≥' }}</span>
          <span class="text">{{ 'userVerification.status.progress.adminVerification' | translate }}</span>
        </div>
      </div>
    </div>

    <!-- Requirements -->
    <div class="verification-requirements">
      <h4>{{ 'userVerification.status.requirements.title' | translate }}</h4>
      <ul>
        <li [class.completed]="hasCompleteProfile">
          <span class="icon">{{ hasCompleteProfile ? '‚úÖ' : '‚≠ï' }}</span>
          {{ 'userVerification.status.requirements.profile100' | translate }}
        </li>
        <li class="completed">
          <span class="icon">‚úÖ</span>
          {{ 'userVerification.status.requirements.emailVerified' | translate }}
        </li>
        <li [class.completed]="hasCompleteProfile">
          <span class="icon">{{ hasCompleteProfile ? '‚úÖ' : '‚≠ï' }}</span>
          {{ 'userVerification.status.requirements.personalData' | translate }}
        </li>
      </ul>
    </div>

    <!-- Button - Solo si tiene perfil completo -->
    <button *ngIf="hasCompleteProfile" class="btn btn-primary btn-large" (click)="requestVerification()"
      [disabled]="requesting">
      <span class="icon">üì®</span>
      {{ requesting ? ('userVerification.status.buttons.sending' | translate)
      : ('userVerification.status.buttons.request' | translate) }}
    </button>

    <!-- Help text si no tiene perfil completo -->
    <div *ngIf="!hasCompleteProfile" class="help-box">
      <span class="icon">‚ÑπÔ∏è</span>
      <p>{{ 'userVerification.status.help.completeProfile' | translate }}</p>
    </div>
  </div>

  <!-- Pending -->
  <div
    *ngIf="!isVerified && verificationStatus && verificationStatus.status === UserVerificationStatus.PENDING && !loading"
    class="pending-card">
    <div class="pending-header">
      <span [class]="getStatusBadgeClass(verificationStatus.status)">
        <span class="icon">{{ getStatusIcon(verificationStatus.status) }}</span>
        {{ getStatusText(verificationStatus.status) }}
      </span>
    </div>

    <div class="pending-content">
      <h3>{{ 'userVerification.status.pending.title' | translate }}</h3>
      <p>{{ 'userVerification.status.pending.desc' | translate }}</p>

      <div class="verification-details">
        <div class="detail-item">
          <span class="label">{{ 'userVerification.status.pending.details.requestedAt' | translate }}</span>
          <span class="value">{{ formatDate(verificationStatus.createdAt) }}</span>
        </div>
        
        <div class="detail-item">
          <span class="label">{{ 'userVerification.status.pending.details.email' | translate }}</span>
          <span class="value">{{ verificationStatus.email }}</span>
        </div>
      </div>

      <div class="pending-actions">
        <button class="btn btn-secondary" (click)="resendVerification()" [disabled]="resending">
          <span class="icon">üîÑ</span>
          {{ resending ? ('userVerification.status.buttons.resending' | translate)
          : ('userVerification.status.buttons.resend' | translate) }}
        </button>
      </div>

      <div class="info-box">
        <span class="icon">‚ÑπÔ∏è</span>
        <p>
          <strong>{{ 'userVerification.status.pending.infoBox.waitTitle' | translate }}</strong>
          {{ 'userVerification.status.pending.infoBox.waitDesc' | translate }}
        </p>
      </div>
    </div>
  </div>

  <!-- Cancelled/Rejected -->
  <div
    *ngIf="!isVerified && verificationStatus && verificationStatus.status === UserVerificationStatus.CANCELLED && !loading"
    class="cancelled-card">
    <div class="cancelled-header">
      <span [class]="getStatusBadgeClass(verificationStatus.status)">
        <span class="icon">{{ getStatusIcon(verificationStatus.status) }}</span>
        {{ getStatusText(verificationStatus.status) }}
      </span>
    </div>

    <div class="cancelled-content">
      <h3>{{ 'userVerification.status.rejected.title' | translate }}</h3>
      <p>{{ 'userVerification.status.rejected.desc' | translate }}</p>

      <!-- Advertencia de √∫ltimo intento -->
      <div *ngIf="isLastAttempt && !hasNoAttemptsLeft" class="alert alert-danger">
        <span class="icon">‚ö†Ô∏è</span>
        <div>
          <strong>¬°ATENCI√ìN! Este es tu √∫ltimo intento</strong>
          <p>Si tu solicitud es rechazada nuevamente, no podr√°s solicitar verificaci√≥n otra vez. Por favor, revisa cuidadosamente tu informaci√≥n personal antes de continuar.</p>
          <ul class="warning-list">
            <li>Verifica que tu DNI sea correcto y coincida con tu documento</li>
            <li>Aseg√∫rate de que tu nombre completo est√© escrito correctamente</li>
            <li>Confirma que tu direcci√≥n y tel√©fono sean v√°lidos</li>
          </ul>
        </div>
      </div>

      <!-- Informaci√≥n de intentos -->
      <div *ngIf="verificationStatus" class="info-box" [class.warning]="isLastAttempt">
        <span class="icon">{{ isLastAttempt ? '‚ö†Ô∏è' : '‚ÑπÔ∏è' }}</span>
        <p>
          <strong>Intentos restantes:</strong> {{ attemptsLeft }} de {{ verificationStatus.maxAttempts }}
        </p>
      </div>

      <!-- Mensaje si ya no tiene intentos -->
      <div *ngIf="hasNoAttemptsLeft" class="alert alert-danger">
        <span class="icon">üö´</span>
        <div>
          <strong>Has alcanzado el l√≠mite de intentos</strong>
          <p>Has agotado todos los intentos disponibles para solicitar la verificaci√≥n. Si crees que esto es un error, por favor contacta al soporte t√©cnico.</p>
        </div>
      </div>

      <button *ngIf="!hasNoAttemptsLeft" class="btn btn-primary" (click)="requestVerification()" [disabled]="requesting || !hasCompleteProfile">
        <span class="icon">üîÑ</span>
        {{ requesting ? ('userVerification.status.buttons.sending' | translate)
        : ('userVerification.status.buttons.requestAgain' | translate) }}
      </button>
    </div>
  </div>

  <!-- Expired -->
  <div
    *ngIf="!isVerified && verificationStatus && verificationStatus.status === UserVerificationStatus.EXPIRED && !loading"
    class="expired-card">
    <div class="expired-header">
      <span [class]="getStatusBadgeClass(verificationStatus.status)">
        <span class="icon">{{ getStatusIcon(verificationStatus.status) }}</span>
        {{ getStatusText(verificationStatus.status) }}
      </span>
    </div>

    <div class="expired-content">
      <h3>{{ 'userVerification.status.expired.title' | translate }}</h3>
      <p>{{ 'userVerification.status.expired.desc' | translate }}</p>

      <button class="btn btn-primary" (click)="requestVerification()" [disabled]="requesting || !hasCompleteProfile">
        <span class="icon">üì®</span>
        {{ requesting ? ('userVerification.status.buttons.sending' | translate)
        : ('userVerification.status.buttons.requestAgain' | translate) }}
      </button>
    </div>
  </div>
</div>