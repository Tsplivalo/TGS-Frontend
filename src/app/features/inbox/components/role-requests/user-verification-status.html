<!-- src/app/features/inbox/components/user-verification/user-verification-status.component.html -->

<div class="user-verification-status">
  <!-- Header -->
  <div class="verification-header">
    <div>
      <h2>Verificaci√≥n de Usuario</h2>
      <p class="subtitle">
        La verificaci√≥n de tu cuenta permite acceder a funciones avanzadas del sistema
      </p>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando estado de verificaci√≥n...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error && !loading" class="error-message">
    <span class="icon">‚ö†Ô∏è</span>
    <div class="error-content">
      <strong>Error</strong>
      <p>{{ error }}</p>
    </div>
    <button class="btn-link" (click)="error = null">Cerrar</button>
  </div>

  <!-- Already Verified -->
  <div *ngIf="isVerified && !loading" class="verified-card">
    <div class="verified-icon">‚úÖ</div>
    <h3>Cuenta Verificada</h3>
    <p>Tu cuenta ha sido verificada exitosamente por un administrador.</p>

    <div class="verified-benefits">
      <h4>Beneficios de la verificaci√≥n:</h4>
      <ul>
        <li>‚úì Acceso completo a funciones avanzadas</li>
        <li>‚úì Capacidad para realizar compras</li>
        <li>‚úì Capacidad para solicitar roles especiales</li>
        <li>‚úì Prioridad en soporte t√©cnico</li>
      </ul>
    </div>
  </div>

  <!-- Not Verified - No Request -->
  <div *ngIf="!isVerified && !verificationStatus && !loading" class="no-verification-card">
    <div class="info-icon">üìã</div>
    <h3>Verificaci√≥n de Cuenta</h3>
    <p>
      Para acceder a todas las funcionalidades del sistema, necesitas verificar tu cuenta.
      Esta verificaci√≥n es revisada manualmente por un administrador.
    </p>

    <!-- Warning si NO tiene perfil completo -->
    <div *ngIf="!hasCompleteProfile" class="alert alert-warning">
      <span class="icon">‚ö†Ô∏è</span>
      <div>
        <strong>Perfil Incompleto</strong>
        <p>
          Debes completar tu perfil al 100% antes de solicitar la verificaci√≥n.
          Aseg√∫rate de tener todos tus datos personales (DNI, nombre, email, tel√©fono y direcci√≥n).
        </p>
        <a routerLink="/mi-cuenta" class="btn btn-secondary btn-sm">
          <span class="icon">üìù</span>
          Completar Perfil Ahora
        </a>
      </div>
    </div>

  <!-- Progress Indicator -->
  <div *ngIf="!hasCompleteProfile" class="profile-progress">
    <h4>Tu Progreso</h4>
    <div class="progress-items">
      <div class="progress-item completed">
        <span class="icon">‚úÖ</span>
        <span class="text">Cuenta creada</span>
      </div>
      <div class="progress-item completed">
        <span class="icon">‚úÖ</span>
        <span class="text">Email verificado</span>
      </div>
      <div class="progress-item" [class.completed]="hasCompleteProfile">
        <span class="icon">{{ hasCompleteProfile ? '‚úÖ' : '‚è≥' }}</span>
        <span class="text">Perfil completado ({{ hasCompleteProfile ? '100' : '< 100' }}%)</span>
      </div>
      <div class="progress-item" [class.completed]="isVerified">
        <span class="icon">{{ isVerified ? '‚úÖ' : '‚è≥' }}</span>
        <span class="text">Verificaci√≥n por admin</span>
      </div>
    </div>
  </div>

    <!-- Requirements -->
    <div class="verification-requirements">
      <h4>Requisitos para la verificaci√≥n:</h4>
      <ul>
        <li [class.completed]="hasCompleteProfile">
          <span class="icon">{{ hasCompleteProfile ? '‚úÖ' : '‚≠ï' }}</span>
          Perfil completo al 100%
        </li>
        <li class="completed">
          <span class="icon">‚úÖ</span>
          Email verificado
        </li>
        <li [class.completed]="hasCompleteProfile">
          <span class="icon">{{ hasCompleteProfile ? '‚úÖ' : '‚≠ï' }}</span>
          Datos personales completos (DNI, nombre, tel√©fono, direcci√≥n)
        </li>
      </ul>
    </div>

    <!-- Button - Solo si tiene perfil completo -->
    <button *ngIf="hasCompleteProfile" class="btn btn-primary btn-large" (click)="requestVerification()"
      [disabled]="requesting">
      <span class="icon">üì®</span>
      {{ requesting ? 'Enviando...' : 'Solicitar Verificaci√≥n' }}
    </button>

    <!-- Help text si no tiene perfil completo -->
    <div *ngIf="!hasCompleteProfile" class="help-box">
      <span class="icon">‚ÑπÔ∏è</span>
      <p>
        Completa tu perfil para poder solicitar la verificaci√≥n de tu cuenta.
      </p>
    </div>
  </div>

  <!-- Pending Verification -->
  <div
    *ngIf="!isVerified && verificationStatus && verificationStatus.status === UserVerificationStatus.PENDING && !loading"
    class="pending-card">
    <div class="pending-header">
      <span [class]="getStatusBadgeClass(verificationStatus.status)">
        <span class="icon">{{ getStatusIcon(verificationStatus.status) }}</span>
        {{ getStatusText(verificationStatus.status) }}
      </span>
    </div>

    <div class="pending-content">
      <h3>Solicitud en Revisi√≥n</h3>
      <p>
        Tu solicitud de verificaci√≥n est√° siendo revisada por un administrador.
        Recibir√°s una notificaci√≥n cuando sea aprobada o rechazada.
      </p>

      <div class="verification-details">
        <div class="detail-item">
          <span class="label">Fecha de solicitud:</span>
          <span class="value">{{ formatDate(verificationStatus.createdAt) }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Expira el:</span>
          <span class="value">{{ formatDate(verificationStatus.expiresAt) }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Email:</span>
          <span class="value">{{ verificationStatus.email }}</span>
        </div>
      </div>

      <div class="pending-actions">
        <button class="btn btn-secondary" (click)="resendVerification()" [disabled]="resending">
          <span class="icon">üîÑ</span>
          {{ resending ? 'Reenviando...' : 'Reenviar Notificaci√≥n' }}
        </button>
      </div>

      <div class="info-box">
        <span class="icon">‚ÑπÔ∏è</span>
        <p>
          <strong>Tiempo de espera:</strong> Las verificaciones suelen procesarse en un plazo de 24-48 horas h√°biles.
        </p>
      </div>
    </div>
  </div>

  <!-- Cancelled/Rejected Verification -->
  <div
    *ngIf="!isVerified && verificationStatus && verificationStatus.status === UserVerificationStatus.CANCELLED && !loading"
    class="cancelled-card">
    <div class="cancelled-header">
      <span [class]="getStatusBadgeClass(verificationStatus.status)">
        <span class="icon">{{ getStatusIcon(verificationStatus.status) }}</span>
        {{ getStatusText(verificationStatus.status) }}
      </span>
    </div>

    <div class="cancelled-content">
      <h3>Solicitud Rechazada</h3>
      <p>
        Tu solicitud de verificaci√≥n fue rechazada por un administrador.
        Por favor, revisa tus datos y vuelve a intentarlo.
      </p>

      <button class="btn btn-primary" (click)="requestVerification()" [disabled]="requesting || !hasCompleteProfile">
        <span class="icon">üîÑ</span>
        {{ requesting ? 'Enviando...' : 'Solicitar Nuevamente' }}
      </button>
    </div>
  </div>

  <!-- Expired Verification -->
  <div
    *ngIf="!isVerified && verificationStatus && verificationStatus.status === UserVerificationStatus.EXPIRED && !loading"
    class="expired-card">
    <div class="expired-header">
      <span [class]="getStatusBadgeClass(verificationStatus.status)">
        <span class="icon">{{ getStatusIcon(verificationStatus.status) }}</span>
        {{ getStatusText(verificationStatus.status) }}
      </span>
    </div>

    <div class="expired-content">
      <h3>Solicitud Expirada</h3>
      <p>
        Tu solicitud de verificaci√≥n ha expirado. Puedes solicitar una nueva verificaci√≥n.
      </p>

      <button class="btn btn-primary" (click)="requestVerification()" [disabled]="requesting || !hasCompleteProfile">
        <span class="icon">üì®</span>
        {{ requesting ? 'Enviando...' : 'Solicitar Nuevamente' }}
      </button>
    </div>
  </div>
</div>