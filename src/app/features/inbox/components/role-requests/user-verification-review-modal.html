<!-- src/app/features/inbox/components/user-verification/user-verification-review-modal.component.html -->

<div class="modal-overlay" (click)="onOverlayClick($event)">
  <div class="modal" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="modal-header">
      <h2>Revisar Verificación de Usuario</h2>
      <button class="close-btn" type="button" (click)="onClose()" aria-label="Cerrar">×</button>
    </div>

    <!-- Modal Body -->
    <form (ngSubmit)="onSubmit()" class="modal-body">
      <!-- Verification Summary -->
      <div class="verification-summary">
        <div class="summary-item">
          <span class="label">Email:</span>
          <span class="value">{{ verification.email }}</span>
        </div>

        <div class="summary-item">
          <span class="label">Fecha de solicitud:</span>
          <span class="value">{{ formatDate(verification.createdAt) }}</span>
        </div>

        <div class="summary-item">
          <span class="label">Expira:</span>
          <span class="value">{{ formatDate(verification.expiresAt) }}</span>
        </div>

        <div class="summary-item">
          <span class="label">Intentos:</span>
          <span class="value">{{ verification.attempts }} / {{ verification.maxAttempts }}</span>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="error" class="error-message">
        <span class="icon">⚠️</span>
        {{ error }}
      </div>

      <!-- Action Selector -->
      <div class="form-group">
        <label>Decisión:</label>
        <div class="action-selector">
          <label [class.selected]="action === 'approve'" class="action-option">
            <input type="radio" name="action" value="approve" [(ngModel)]="action" [disabled]="isSubmitting" />
            <span class="icon">✓</span>
            <span class="text">Aprobar</span>
          </label>

          <label [class.selected]="action === 'reject'" class="action-option">
            <input type="radio" name="action" value="reject" [(ngModel)]="action" [disabled]="isSubmitting" />
            <span class="icon">✗</span>
            <span class="text">Rechazar</span>
          </label>
        </div>
      </div>

      <!-- Reject Reason (Solo si action === 'reject') -->
      <div *ngIf="action === 'reject'" class="form-group">
        <label for="reason">
          Motivo del rechazo <span class="optional">(opcional)</span>:
        </label>
        <textarea id="reason" [(ngModel)]="reason" name="reason"
          placeholder="Explica por qué se rechaza la verificación (opcional, mínimo 3 caracteres si lo proporcionas)"
          [disabled]="isSubmitting" minlength="3" maxlength="500" rows="4"></textarea>
        <div class="character-count">
          {{ reason.length }}/500 caracteres
          <span *ngIf="reason.length > 0 && reason.length < 3" class="warning">
            (mínimo 3 si proporcionas un motivo)
          </span>
        </div>
        <p class="help-text">
          Este motivo será visible para el usuario en caso de rechazo.
        </p>
      </div>

      <!-- Info Box (Solo si action === 'approve') -->
      <div *ngIf="action === 'approve'" class="info-box">
        <span class="icon">ℹ️</span>
        <div>
          <strong>Al aprobar esta verificación:</strong>
          <ul>
            <li>El usuario será marcado como verificado</li>
            <li>Se actualizará su completitud de perfil al 100%</li>
            <li>Recibirá un email de confirmación</li>
            <li>Podrá realizar compras en el sistema</li>
            <li>Podrá solicitar roles especiales</li>
          </ul>
        </div>
      </div>
    </form>

    <!-- Modal Actions -->
    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" (click)="onClose()" [disabled]="isSubmitting">
        Cancelar
      </button>
      <button type="submit" [class]="action === 'approve' ? 'btn btn-success' : 'btn btn-danger'"
        [disabled]="isSubmitting || (action === 'reject' && reason.length > 0 && reason.length < 3)"
        (click)="onSubmit()">
        <span class="icon">{{ action === 'approve' ? '✓' : '✗' }}</span>
        {{ isSubmitting ? 'Procesando...' : action === 'approve' ? 'Aprobar Verificación' : 'Rechazar Verificación' }}
      </button>
    </div>
  </div>
</div>