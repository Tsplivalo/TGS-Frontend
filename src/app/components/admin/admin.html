<section class="stack-lg">

  <div class="glass-dark card stack-md">
    <!-- HEADER + TOOLBAR -->
    <header class="header">
      <h2 class="title">{{ 'admin.title' | translate }}</h2>
      <div class="right">
        <button class="btn" type="button" (click)="toggleNew()" [attr.aria-expanded]="isNewOpen()">
          {{ isNewOpen() ? ('common.close' | translate) : ('admin.buttons.new' | translate) }}
        </button>
      </div>
    </header>

    <div *ngIf="!loading() && items().length > 0"
      style="display: flex; gap: var(--sp-4); padding: var(--sp-3); background: rgba(195, 164, 98, 0.08); border-radius: 8px; border: 1px solid rgba(195, 164, 98, 0.2); margin-bottom: var(--sp-3);">
      <span class="muted"><strong>{{ 'admin.stats.totalLabel' | translate }}</strong> {{ totalAdmins() }}</span>
      <span class="muted" *ngIf="fTextApplied()"><strong>{{ 'admin.stats.filteredLabel' | translate }}</strong> {{
        filtered().length }}</span>
    </div>

    <!-- FILTROS -->
    <section class="filters" style="align-items: flex-end;">
      <label class="label" style="flex: 1;">
        <span>{{ 'admin.filters.search' | translate }}</span>
        <input class="input" type="text" [ngModel]="fTextInput()" (ngModelChange)="fTextInput.set($event)"
          (keyup.enter)="applyFilters()" [placeholder]="'admin.filters.searchPlaceholder' | translate" />
      </label>

      <div style="display: flex; gap: var(--sp-2);">
        <button class="btn btn-primary" type="button" (click)="applyFilters()">
          🔍 {{ 'common.search' | translate }}
        </button>
        <button class="btn ghost" type="button" (click)="clearFilters()" *ngIf="fTextApplied()">
          🗑️ {{ 'common.clear' | translate }}
        </button>
      </div>
    </section>

    <!-- MENSAJES -->
    <div class="error" *ngIf="error() as err"><strong>{{ 'common.error' | translate }}</strong>: {{ err }}</div>
    <div class="muted" *ngIf="loading()">{{ 'admin.messages.loading' | translate }}</div>

    <!-- LISTADO -->
    <section class="subsection">
      <h3 class="sub-title">{{ 'admin.list' | translate }}</h3>

      <div class="table-wrap" *ngIf="filtered().length; else emptyState">
        <table class="table">
          <thead>
            <tr>
              <th style="width:140px;">{{ 'admin.fields.dni' | translate }}</th>
              <th>{{ 'admin.fields.name' | translate }}</th>
              <th>{{ 'admin.fields.email' | translate }}</th>
              <th style="width:160px;">{{ 'admin.fields.phone' | translate }}</th>
              <th class="right" style="width:160px;">{{ 'common.edit' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let it of filtered(); trackBy: trackByDni">
              <td class="mono">#{{ it.dni }}</td>
              <td>{{ it.name }}</td>
              <td class="truncate">{{ it.email }}</td>
              <td class="truncate">{{ it.phone || '—' }}</td>
              <td class="right">
                <button class="btn ghost btn--icon" type="button" (click)="edit(it)"
                  [title]="'common.edit' | translate">
                  ✏️ <span class="sr-only">{{ 'common.edit' | translate }}</span>
                </button>
                <button class="btn danger btn--icon" type="button" (click)="delete(it)"
                  [title]="'common.delete' | translate">
                  🗑️ <span class="sr-only">{{ 'common.delete' | translate }}</span>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty state -->
      <ng-template #emptyState>
        <div class="empty empty-state">
          <h3>{{ fTextApplied() ? ('distributors.noResults.title' | translate) : ('admin.emptyTitle' | translate) }}
          </h3>
          <p class="muted">{{ fTextApplied() ? ('distributors.noResults.desc' | translate) : ('admin.emptyHint' |
            translate) }}</p>
        </div>
      </ng-template>
    </section>
  </div>

  <!-- FORM (COLAPSABLE) -->
  <div class="collapsible" [class.open]="isNewOpen()">
    <div class="collapsible__content glass-dark card">
      <div class="header">
        <h2 class="title">
          {{ isEdit()
          ? ('admin.form.titleEdit' | translate:{ dni: form.value.dni })
          : ('admin.form.titleCreate' | translate) }}
        </h2>
      </div>

      <form [formGroup]="form" class="form-grid" (ngSubmit)="save()">
        <label class="label">
          <span>{{ 'admin.fields.dni' | translate }}</span>
          <input class="input" type="text" formControlName="dni" [readonly]="isEdit()" />
        </label>

        <label class="label">
          <span>{{ 'admin.fields.name' | translate }}</span>
          <input class="input" type="text" formControlName="name" />
        </label>

        <label class="label">
          <span>{{ 'admin.fields.email' | translate }}</span>
          <input class="input" type="email" formControlName="email" />
        </label>

        <label class="label">
          <span>{{ 'admin.fields.phone' | translate }}</span>
          <input class="input" type="text" formControlName="phone" />
        </label>

        <div class="form-actions">
          <button class="btn success" type="submit" [disabled]="form.invalid || loading()">
            {{ isEdit() ? ('admin.buttons.save' | translate) : ('admin.buttons.create' | translate) }}
          </button>
          <button class="btn ghost" type="button" (click)="new()" [disabled]="loading()">
            {{ 'admin.buttons.clear' | translate }}
          </button>
        </div>
      </form>
    </div>
  </div>

</section>