<section class="login-page">
  <div class="login-card">
    <header class="login-header">
      <h1>Iniciar SesiÃ³n</h1>
      <p>Ingresa tus credenciales para acceder</p>
    </header>

    <!-- âš ï¸ Banner de verificaciÃ³n de email requerida -->
    <div class="verification-alert" *ngIf="needsEmailVerification()" role="alert">
      <div class="alert-icon">âš ï¸</div>
      <div class="alert-content">
        <strong>Email no verificado</strong>
        <p>Debes verificar tu email antes de iniciar sesiÃ³n.</p>

        <!-- Mensaje de email enviado -->
        <div class="email-sent-message" *ngIf="emailSent()">
          <span class="success-icon">âœ“</span>
          <strong>Email de verificaciÃ³n enviado</strong>
          <p>Revisa tu bandeja de entrada y haz clic en el enlace para verificar tu cuenta.</p>
        </div>

        <!-- Mensaje cuando NO se ha enviado aÃºn -->
        <div *ngIf="!emailSent()">
          <p><strong>Â¿No recibiste el email?</strong> Haz clic en el botÃ³n de abajo para reenviarlo.</p>
        </div>

        <!-- BotÃ³n de reenvÃ­o con temporizador -->
        <button type="button" class="btn-resend-small" (click)="resendVerificationEmail()"
          [disabled]="resendingEmail() || !canResend()">
          <span *ngIf="resendingEmail()">â³ Enviando...</span>
          <span *ngIf="!resendingEmail() && !canResend()">ğŸ“§ Reenviar email ({{ resendCooldown() }}s)</span>
          <span *ngIf="!resendingEmail() && canResend() && emailSent()">ğŸ“§ Reenviar nuevamente</span>
          <span *ngIf="!resendingEmail() && canResend() && !emailSent()">ğŸ“§ Enviar email de verificaciÃ³n</span>
        </button>
      </div>
    </div>

    <!-- ğŸ”„ Banner de espera de verificaciÃ³n (cuando estÃ¡ esperando que el usuario verifique desde el link) -->
    <div class="waiting-verification" *ngIf="waitingForVerification() && !loading()" role="status">
      <div class="spinner-small"></div>
      <div class="waiting-content">
        <strong>Esperando verificaciÃ³n...</strong>
        <p>Haz clic en el enlace que enviamos a tu email. Esta pÃ¡gina se actualizarÃ¡ automÃ¡ticamente cuando verifiques tu cuenta.</p>

        <!-- BotÃ³n de reenvÃ­o con temporizador -->
        <button type="button" class="btn-resend-small" (click)="resendVerificationEmail()"
          [disabled]="resendingEmail() || !canResend()">
          <span *ngIf="resendingEmail()">â³ Enviando...</span>
          <span *ngIf="!resendingEmail() && !canResend()">ğŸ“§ Reenviar email ({{ resendCooldown() }}s)</span>
          <span *ngIf="!resendingEmail() && canResend()">ğŸ“§ Reenviar email</span>
        </button>
      </div>
    </div>

    <!-- Mensaje de error general -->
    <div class="error-message" *ngIf="error() && !needsEmailVerification()" role="alert">
      {{ error() }}
    </div>

    <!-- Formulario de login -->
    <form (submit)="onSubmit(); $event.preventDefault()" class="login-form">
      <div class="form-group">
        <label for="email">Email o Usuario</label>
        <input id="email" type="text" [value]="email()" (input)="email.set($any($event.target).value)"
          placeholder="tu@email.com o tu_usuario" required autocomplete="username" />
      </div>

      <div class="form-group">
        <label for="password">ContraseÃ±a</label>
        <input id="password" type="password" [value]="password()" (input)="password.set($any($event.target).value)"
          placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required autocomplete="current-password" />
      </div>

      <button type="submit" class="btn-login" [disabled]="loading()">
        {{ loading() ? 'Iniciando sesiÃ³n...' : 'Iniciar SesiÃ³n' }}
      </button>
    </form>

    <footer class="login-footer">
      <p>Â¿No tienes cuenta? <a routerLink="/register">RegÃ­strate aquÃ­</a></p>
    </footer>
  </div>
</section>