<div class="reset-password-container">
  <div class="reset-password-card glass">
    <!-- State: Validating -->
    <div *ngIf="state() === 'validating'" class="reset-password-content">
      <div class="spinner"></div>
      <h2 class="title">{{ 'auth.resetPassword.validating' | translate }}</h2>
      <p class="subtitle">{{ 'auth.resetPassword.pleaseWait' | translate }}</p>
    </div>

    <!-- State: Form -->
    <div *ngIf="state() === 'form'" class="reset-password-content">
      <div class="header-section">
        <h2 class="title">{{ 'auth.resetPassword.title' | translate }}</h2>
        <p class="subtitle">{{ 'auth.resetPassword.subtitle' | translate }}</p>
      </div>

      <form (ngSubmit)="resetPassword()" class="reset-form">
        <div class="form-group">
          <label for="password">{{ 'auth.resetPassword.newPasswordLabel' | translate }}</label>
          <div class="input-with-toggle">
            <input
              [type]="showPassword ? 'text' : 'password'"
              id="password"
              name="password"
              [(ngModel)]="newPassword"
              required
              minlength="12"
              class="form-input"
              [placeholder]="'auth.resetPassword.passwordPlaceholder' | translate"
            />
            <button
              type="button"
              class="pwd-toggle"
              (click)="togglePasswordVisibility('password')"
            >
              <span class="material-symbols-outlined">
                {{ showPassword ? 'visibility_off' : 'visibility' }}
              </span>
            </button>
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">{{ 'auth.resetPassword.confirmPasswordLabel' | translate }}</label>
          <div class="input-with-toggle">
            <input
              [type]="showConfirmPassword ? 'text' : 'password'"
              id="confirmPassword"
              name="confirmPassword"
              [(ngModel)]="confirmPassword"
              required
              class="form-input"
              [placeholder]="'auth.resetPassword.confirmPlaceholder' | translate"
            />
            <button
              type="button"
              class="pwd-toggle"
              (click)="togglePasswordVisibility('confirm')"
            >
              <span class="material-symbols-outlined">
                {{ showConfirmPassword ? 'visibility_off' : 'visibility' }}
              </span>
            </button>
          </div>
        </div>

        <div class="password-requirements">
          <strong>{{ 'auth.resetPassword.requirementsTitle' | translate }}</strong>
          <ul>
            <li>{{ 'auth.resetPassword.minLength' | translate }}</li>
            <li>{{ 'auth.resetPassword.uppercase' | translate }}</li>
            <li>{{ 'auth.resetPassword.lowercase' | translate }}</li>
            <li>{{ 'auth.resetPassword.number' | translate }}</li>
            <li>{{ 'auth.resetPassword.special' | translate }}</li>
          </ul>
        </div>

        <button type="submit" class="btn btn-primary" [disabled]="isLoading()">
          {{ isLoading() ? ('auth.resetPassword.processing' | translate) : ('auth.resetPassword.resetButton' | translate) }}
        </button>

        <div *ngIf="error()" class="error-message">{{ error() }}</div>
      </form>
    </div>

    <!-- State: Success -->
    <div *ngIf="state() === 'success'" class="reset-password-content success-state">
      <div class="success-icon">✓</div>
      <h2 class="title">{{ 'auth.resetPassword.successTitle' | translate }}</h2>
      <p class="subtitle">{{ 'auth.resetPassword.successMessage' | translate }}</p>
      <p class="info-text">{{ 'auth.resetPassword.redirecting' | translate }}</p>
      <button type="button" class="btn btn-primary" (click)="goToLogin()">
        {{ 'auth.resetPassword.goToLogin' | translate }}
      </button>
    </div>

    <!-- State: Error -->
    <div *ngIf="state() === 'error'" class="reset-password-content error-state">
      <div class="error-icon">✕</div>
      <h2 class="title">{{ 'common.error' | translate }}</h2>
      <p class="error-message">{{ error() }}</p>
      <button type="button" class="btn btn-primary" (click)="goToForgotPassword()">
        {{ 'auth.resetPassword.requestNewLink' | translate }}
      </button>
    </div>
  </div>
</div>
