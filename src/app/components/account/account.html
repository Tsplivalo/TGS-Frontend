<!-- account.html (i18n aplicado) -->
<section class="account stack-lg">
  <header>
    <h2 id="account-title">{{ 'account.title' | translate }}</h2>
    <div class="profile-stats" *ngIf="me()">
      <span class="completeness" [class.complete]="profileCompleteness() === 100">
        {{ profileCompleteness() }}{{ 'inbox.profileCompletenessSuffix' | translate }}
      </span>
      <span class="verified" *ngIf="me()?.isVerified">{{ 'account.infoSection.adminVerified' | translate }}</span>


    </div>
  </header>

  <!-- âš ï¸ Banner de verificaciÃ³n de email -->
  <div class="verification-banner" *ngIf="!loading() && me() && !me()?.emailVerified" role="alert">
    <div class="banner-content">
      <div class="banner-icon">âš ï¸</div>
      <div class="banner-text">
        <strong>{{ 'account.verificationBanner.title' | translate }}</strong>
        <p>{{ 'account.verificationBanner.desc' | translate }}</p>
      </div>
      <button class="btn-resend" (click)="resendVerificationEmail()" [disabled]="resendingEmail()" type="button">
        {{ resendingEmail() ? ('account.verificationBanner.sending' | translate) : ('account.verificationBanner.resend'
        | translate) }}
      </button>
    </div>
  </div>

  <!-- Estado de carga -->
  <div class="muted" *ngIf="loading()" role="status" aria-live="polite">
    {{ 'account.loadingProfile' | translate }}
  </div>

  <!-- Mensaje para completar perfil -->
  <div class="info-banner" *ngIf="showCompleteProfileMessage() && !hasPersonalInfo()" role="alert">
    <strong>âš ï¸ {{ 'account.completeProfileBanner.title' | translate }}</strong>
    <p>{{ 'account.completeProfileBanner.desc' | translate }}</p>
  </div>

  <!-- Sugerencias de perfil -->
  <div class="suggestions" *ngIf="!loading() && me() && profileCompleteness() < 100">
    <h3>{{ 'account.improveProfile' | translate }}</h3>
    <ul>
      <li *ngFor="let suggestion of getProfileSuggestions()">{{ suggestion }}</li>
    </ul>
  </div>

  <!-- Requisitos para comprar -->
  <div class="requirements" *ngIf="!loading() && me() && !canPurchase()">
    <h3>{{ 'account.purchaseRequirements.title' | translate }}</h3>
    <ul>
      <li *ngFor="let req of getPurchaseRequirements()">{{ req }}</li>
    </ul>
  </div>

  <!-- Errores -->
  <div class="error" *ngIf="error() as e" role="alert" aria-live="assertive">
    {{ e }}
  </div>

  <!-- Mensajes de Ã©xito -->
  <div class="ok" *ngIf="ok() as m" role="status" aria-live="polite">
    {{ m }}
  </div>

  <!-- Formulario de perfil -->
  <form #formEl *ngIf="!loading() && me()" (submit)="save(formEl); $event.preventDefault()"
    aria-labelledby="account-title" novalidate>

    <div class="grid">
      <!-- Username (solo lectura si ya estÃ¡ establecido) -->
      <label for="f-username">
        <span>{{ 'account.fields.username' | translate }}</span>
        <input id="f-username" name="username" [value]="me()?.username || ''" autocomplete="username" disabled
          maxlength="100" />
      </label>

      <!-- Email (siempre solo lectura) -->
      <label for="f-email">
        <span>{{ 'account.fields.email' | translate }}</span>
        <input id="f-email" type="email" [value]="me()?.email || ''" autocomplete="email" disabled />
      </label>

      <!-- DNI (solo editable si no tiene informaciÃ³n personal) -->
      <label for="f-dni">
        <span>DNI *</span>
        <input id="f-dni" name="dni" [attr.type]="me()?.hasPersonalInfo ? 'password' : 'text'" [value]="me()?.hasPersonalInfo ? '********' : ''"
          [disabled]="me()?.hasPersonalInfo" [required]="!me()?.hasPersonalInfo" autocomplete="off" maxlength="10"
          minlength="7" placeholder="12345678" />
      </label>

      <!-- Nombre completo -->
      <label for="f-name">
        <span>{{ 'account.fields.firstName' | translate }} *</span>
        <input id="f-name" name="name" [attr.type]="me()?.hasPersonalInfo ? 'password' : 'text'" [value]="me()?.hasPersonalInfo ? '********' : ''"
          [disabled]="me()?.hasPersonalInfo" [required]="!me()?.hasPersonalInfo" autocomplete="name" maxlength="100"
          placeholder="Juan PÃ©rez" />
      </label>

      <!-- TelÃ©fono -->
      <label for="f-phone">
        <span>{{ 'account.fields.phone' | translate }} *</span>
        <input id="f-phone" name="phone" [attr.type]="me()?.hasPersonalInfo ? 'password' : 'tel'" inputmode="tel" [value]="me()?.hasPersonalInfo ? '********' : ''"
          autocomplete="tel" [disabled]="me()?.hasPersonalInfo" [required]="!me()?.hasPersonalInfo" maxlength="24"
          placeholder="+54 9 11 1234-5678" />
      </label>

      <!-- DirecciÃ³n -->
      <label class="wide" for="f-address">
        <span>{{ 'account.fields.address' | translate }} *</span>
        <input id="f-address" name="address" [attr.type]="me()?.hasPersonalInfo ? 'password' : 'text'" [value]="me()?.hasPersonalInfo ? '********' : ''"
          autocomplete="street-address" [disabled]="me()?.hasPersonalInfo" [required]="!me()?.hasPersonalInfo"
          maxlength="200" placeholder="Av. Siempre Viva 123" />
      </label>
    </div>

    <!-- Botones de acciÃ³n -->
    <div class="actions">
      <!-- Mostrar botÃ³n solo si NO tiene informaciÃ³n personal -->
      <button type="submit" *ngIf="!me()?.hasPersonalInfo" [disabled]="saving()"
        [attr.aria-busy]="saving() ? 'true' : null">
        {{ saving() ? ('account.actions.saving' | translate) : ('account.actions.completeProfile' | translate) }}
      </button>

      <!-- Mensaje informativo si ya tiene datos -->
      <p class="info-text" *ngIf="me()?.hasPersonalInfo">
        {{ 'account.readonlyNote' | translate }}
      </p>
    </div>
  </form>

  <!-- InformaciÃ³n adicional -->
  <div class="info-section" *ngIf="me()">
    <h3>{{ 'account.infoSection.title' | translate }}</h3>
    <dl>
      <dt>{{ 'account.infoSection.status' | translate }}</dt>
      <dd>{{ me()?.isActive ? ('account.infoSection.active' | translate) : ('account.infoSection.inactive' | translate)
        }}</dd>

      <dt>{{ 'account.infoSection.emailVerified' | translate }}</dt>
      <dd>{{ me()?.emailVerified ? ('account.infoSection.emailVerifiedYes' | translate) :
        ('account.infoSection.emailVerifiedNo' | translate) }}</dd>

      <dt>{{ 'account.infoSection.roles' | translate }}</dt>
      <dd>{{ me()?.roles?.join(', ') || 'N/A' }}</dd>

      <dt>{{ 'account.infoSection.memberSince' | translate }}</dt>
      <dd>{{ me()?.createdAt | date:'longDate' }}</dd>
    </dl>
  </div>
</section>
